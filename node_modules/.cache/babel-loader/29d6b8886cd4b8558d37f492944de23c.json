{"ast":null,"code":"var _jsxFileName = \"/Users/shengjiayu/Documents/GitHub/cs185-react/src/Components/Graph.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport config from '../config';\n\nconst firebase = require('firebase');\n\nexport class Graph extends Component {\n  constructor() {\n    super();\n\n    this.loadGraph = () => {\n      let element = document.getElementById('graph');\n      element.appendChild(this.createGraph());\n    };\n\n    this.drag = simulation => {\n      function dragStarted(d) {\n        if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n        d.fx = d.x;\n        d.fy = d.y;\n      }\n\n      function dragged(d) {\n        d.fx = d3.event.x;\n        d.fy = d3.event.y;\n      }\n\n      function dragEnded(d) {\n        if (!d3.event.active) {\n          simulation.alphaTarget(0);\n        }\n\n        d.fx = null;\n        d.fy = null;\n      }\n\n      return d3.drag().on('start', dragStarted).on('drag', dragged).on('end', dragEnded);\n    };\n\n    this.createGraph = () => {\n      const headerOffset = document.getElementsByClassName('header')[0].offsetHeight;\n      const navbarOffset = document.getElementsByClassName('navheader')[0].offsetHeight;\n      const width = window.innerWidth * 1.6;\n      const height = (window.innerHeight - headerOffset - navbarOffset) * 1.6;\n      let allNodes = this.state.nodes.movies.concat(this.state.nodes.actors);\n      let movieNodes = this.state.nodes.movies;\n      let links = this.state.links;\n      let svg = d3.create('svg').attr('viewBox', [0, 0, width, height]);\n      let simulation = d3.forceSimulation(allNodes).force('link', d3.forceLink().links(links).id(d => {\n        return d.index;\n      }).distance(200)).force('repel', d3.forceManyBody().distanceMin(100).distanceMax(500).strength(-300)).force('attract', d3.forceManyBody().distanceMin(300).distanceMax(1000).strength(100)).force('center', d3.forceCenter(width / 2, height / 2));\n      let link = svg.append('g').attr('stroke', '#777').attr('stroke-opacity', 1).selectAll('line').data(links).join('line').attr('stroke-width', 2);\n\n      let radius = node => {\n        if (node.type === 'actor') {\n          return 25;\n        }\n\n        return 100;\n      };\n\n      let fill = node => {\n        if (node.type === 'movie') {\n          console.log('url(#' + node.title.replace(/[ ']/g, '_') + '-' + node.year + ')');\n          return 'url(#' + node.title.replace(/[ ']/g, '_') + '-' + node.year + ')';\n        }\n\n        return d3.color('rgb(191, 215, 228)');\n      };\n\n      let hovering = false;\n      let hoverId = '';\n      let hoverNode = null;\n\n      let handleMouseOver = (d, i) => {\n        svg.append('text').attr('id', 'text-' + i).style('text-anchor', 'middle').attr('x', () => d.x).attr('y', () => d.y + 50).text(d.name);\n        hovering = true;\n        hoverId = 'text-' + i;\n        hoverNode = d;\n      };\n\n      let handleMouseOut = (d, i) => {\n        d3.select('#text-' + i).remove();\n        hovering = false;\n      };\n\n      let defs = svg.append('defs');\n      movieNodes.forEach(movieNode => {\n        defs.append('pattern').attr('id', movieNode.title.replace(/[ ']/g, '_') + '-' + movieNode.year).attr('width', 1).attr('height', 1).attr('x', -35).attr('y', -35).append('image').attr('xlink:href', movieNode.poster).attr('width', 200).attr('height', 200);\n      });\n      let node = svg.append('g').attr('stroke', '#fff').attr('stroke-width', 1.5).selectAll('circle').data(allNodes).join('circle').attr('r', radius).attr('fill', fill).on('mouseover', handleMouseOver).on('mouseout', handleMouseOut).call(this.drag(simulation));\n      simulation.on('tick', () => {\n        link.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);\n        node.attr('cx', d => d.x).attr('cy', d => d.y);\n\n        if (hovering) {\n          d3.select('#' + hoverId).attr('x', () => hoverNode.x).attr('y', () => hoverNode.y + 50);\n        }\n      });\n      return svg.node();\n    };\n\n    this.state = {\n      nodes: {\n        movies: [],\n        actors: []\n      },\n      links: []\n    };\n    this.graph = React.createRef();\n  }\n\n  componentDidMount() {\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    let movieNodes = [];\n    let actorNodes = [];\n    let links = [];\n    let ref = firebase.database().ref('graph');\n    ref.on('value', snapshot => {\n      if (!snapshot.val()) return;\n      let movies = snapshot.val();\n      console.log(movies);\n\n      for (let entry in movies) {\n        if (movies[entry].lists === 'Action') {\n          console.log(\"Found list\");\n        }\n\n        console.log(\"Not Found list\");\n      }\n\n      let moviesLength = Object.values(movies).length;\n      console.log(moviesLength);\n      Object.values(movies).forEach(movie => {\n        movie.type = 'movie';\n        console.log(movie);\n        movieNodes.push(movie);\n        movie.actors.forEach(actor => {\n          let exists = false;\n          let actorIndex = -1;\n\n          for (let i = 0; i < actorNodes.length; i++) {\n            let n = actorNodes[i];\n\n            if (n.name === actor) {\n              exists = true;\n              actorIndex = i;\n              break;\n            }\n          }\n\n          let link = {};\n\n          if (exists) {\n            link = {\n              source: movieNodes.length - 1,\n              target: moviesLength + actorIndex\n            };\n          } else {\n            let node = {\n              name: actor,\n              type: 'actor'\n            };\n            actorNodes.push(node);\n            link = {\n              source: movieNodes.length - 1,\n              target: moviesLength + actorNodes.length - 1\n            };\n          }\n\n          links.push(link);\n        });\n      });\n      movieNodes = this.state.nodes.movies.concat(movieNodes);\n      actorNodes = this.state.nodes.actors.concat(actorNodes);\n      links = this.state.links.concat(links);\n      this.setState({\n        'nodes': {\n          'movies': movieNodes,\n          'actors': actorNodes\n        },\n        'links': links\n      }, this.loadGraph);\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"graph\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 17\n      }\n    }, \"Movies Graph \"));\n  }\n\n}\nexport default Graph;","map":{"version":3,"sources":["/Users/shengjiayu/Documents/GitHub/cs185-react/src/Components/Graph.js"],"names":["React","Component","d3","config","firebase","require","Graph","constructor","loadGraph","element","document","getElementById","appendChild","createGraph","drag","simulation","dragStarted","d","event","active","alphaTarget","restart","fx","x","fy","y","dragged","dragEnded","on","headerOffset","getElementsByClassName","offsetHeight","navbarOffset","width","window","innerWidth","height","innerHeight","allNodes","state","nodes","movies","concat","actors","movieNodes","links","svg","create","attr","forceSimulation","force","forceLink","id","index","distance","forceManyBody","distanceMin","distanceMax","strength","forceCenter","link","append","selectAll","data","join","radius","node","type","fill","console","log","title","replace","year","color","hovering","hoverId","hoverNode","handleMouseOver","i","style","text","name","handleMouseOut","select","remove","defs","forEach","movieNode","poster","call","source","target","graph","createRef","componentDidMount","apps","length","initializeApp","actorNodes","ref","database","snapshot","val","entry","lists","moviesLength","Object","values","movie","push","actor","exists","actorIndex","n","setState","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport config from '../config';\n\nconst firebase = require('firebase');\n\nexport class Graph extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.state = {\n\t\t\tnodes: {\n\t\t\t\tmovies: [],\n\t\t\t\tactors: []\n\t\t\t},\n\t\t\tlinks: []\n\t\t}\n\t\tthis.graph = React.createRef();\n\t}\n\n\tcomponentDidMount() {\n\t\tif (!firebase.apps.length) {\n\t\t\tfirebase.initializeApp(config);\n\t\t}\n\n\t\tlet movieNodes = [];\n\t\tlet actorNodes = [];\n\t\tlet links = [];\n\n\t\tlet ref = firebase.database().ref('graph');\n\t\tref.on('value', snapshot => {\n\t\t\tif (!snapshot.val()) return;\n\n            let movies = snapshot.val();\n            console.log(movies);\n\n            for (let entry in movies) {\n                if(movies[entry].lists === 'Action') {\n                    console.log(\"Found list\");\n                }\n                console.log(\"Not Found list\");\n            }\n\n            let moviesLength = Object.values(movies).length;\n            console.log(moviesLength);\n\t\t\tObject.values(movies).forEach(movie => {\n\t\t\t\tmovie.type = 'movie';\n\t\t\t\tconsole.log(movie);\n\t\t\t\tmovieNodes.push(movie);\n\n\t\t\t\tmovie.actors.forEach(actor => {\n\t\t\t\t\tlet exists = false;\n\t\t\t\t\tlet actorIndex = -1;\n\t\t\t\t\tfor (let i = 0; i < actorNodes.length; i++) {\n\t\t\t\t\t\tlet n =  actorNodes[i];\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tif (n.name === actor) {\n\t\t\t\t\t\t\texists = true;\n\t\t\t\t\t\t\tactorIndex = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\tlet link = {};\n\t\t\t\t\tif (exists) {\n\t\t\t\t\t\tlink = {\n\t\t\t\t\t\t\tsource: movieNodes.length - 1,\n\t\t\t\t\t\t\ttarget: moviesLength + actorIndex,\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet node = {\n\t\t\t\t\t\t\tname: actor,\n\t\t\t\t\t\t\ttype: 'actor'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tactorNodes.push(node);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlink = {\n\t\t\t\t\t\t\tsource: movieNodes.length - 1,\n\t\t\t\t\t\t\ttarget: moviesLength + actorNodes.length - 1,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\n\t\t\t\t\tlinks.push(link);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tmovieNodes = this.state.nodes.movies.concat(movieNodes);\n\t\t\tactorNodes = this.state.nodes.actors.concat(actorNodes);\n\t\t\tlinks = this.state.links.concat(links);\n\t\n\t\t\tthis.setState({\n\t\t\t\t'nodes': {\n\t\t\t\t\t'movies': movieNodes,\n\t\t\t\t\t'actors': actorNodes\n\t\t\t\t},\n\t\t\t\t'links': links\n\t\t\t}, this.loadGraph);\n\t\t});\n\n\t}\n\t\n\tloadGraph = () => {\n\t\tlet element = document.getElementById('graph');\n\t\telement.appendChild(this.createGraph());\n\t}\n\n\tdrag = (simulation) => {\n\t\tfunction dragStarted(d) {\n\t\t\tif (!d3.event.active) simulation.alphaTarget(0.3).restart();\n\t\t\td.fx = d.x;\n\t\t\td.fy = d.y;\n\t\t}\n\n\t\tfunction dragged(d) {\n\t\t\td.fx = d3.event.x;\n\t\t\td.fy = d3.event.y;\n\t\t}\n\n\t\tfunction dragEnded(d) {\n\t\t\tif (!d3.event.active){\n                simulation.alphaTarget(0);\n            } \n\t\t\td.fx = null;\n\t\t\td.fy = null;\n\t\t}\n\n\t\treturn d3.drag()\n\t\t\t.on('start', dragStarted)\n\t\t\t.on('drag', dragged)\n\t\t\t.on('end', dragEnded);\n\t}\n\n\tcreateGraph = () => {\n        const headerOffset = document.getElementsByClassName('header')[0].offsetHeight;\n        const navbarOffset = document.getElementsByClassName('navheader')[0].offsetHeight;\n\t\tconst width = window.innerWidth*1.6;\n        const height = (window.innerHeight-headerOffset-navbarOffset)*1.6;\n\n\t\tlet allNodes = this.state.nodes.movies.concat(this.state.nodes.actors);\n\t\tlet movieNodes = this.state.nodes.movies;\n\t\tlet links = this.state.links;\n\n\t\tlet svg = d3.create('svg').attr('viewBox', [0, 0, width, height]);\n\t\t\n\t\tlet simulation = d3.forceSimulation(allNodes)\n\t\t\t.force('link', d3.forceLink().links(links).id(d => { return d.index; }).distance(200))\n\t\t\t.force('repel', d3.forceManyBody().distanceMin(100).distanceMax(500).strength(-300))\n\t\t\t.force('attract', d3.forceManyBody().distanceMin(300).distanceMax(1000).strength(100))\n\t\t\t.force('center', d3.forceCenter(width / 2, height / 2));\n\n\t\tlet link = svg.append('g')\n\t\t\t.attr('stroke', '#777')\n\t\t\t.attr('stroke-opacity', 1)\n\t\t\t.selectAll('line')\n\t\t\t.data(links)\n\t\t\t.join('line')\n\t\t\t.attr('stroke-width', 2);\n\n\t\tlet radius = (node) => {\n\t\t\tif(node.type === 'actor') {\n                return 25;\n              } \n              return 100;\n        }\n        \n        \n      \n\n\t\tlet fill = (node) => {\n            if (node.type === 'movie'){\n                console.log('url(#' + node.title.replace(/[ ']/g, '_') + '-' + node.year + ')');\n                return 'url(#' + node.title.replace(/[ ']/g, '_') + '-' + node.year + ')';\n            }\n\t\t\treturn d3.color('rgb(191, 215, 228)');\n\t\t}\n\t\t\n\t\tlet hovering = false;\n\t\tlet hoverId = '';\n\t\tlet hoverNode = null;\n\t\t\n\t\tlet handleMouseOver = (d, i) => {\n\t\t\tsvg.append('text')\n\t\t\t\t.attr('id', 'text-' + i)\n\t\t\t\t.style('text-anchor', 'middle')\n\t\t\t\t.attr('x', () => d.x)\n\t\t\t\t.attr('y', () => d.y + 50)\n\t\t\t\t.text(d.name);\n\t\t\t\n\t\t\thovering = true;\n\t\t\thoverId = 'text-' + i;\n\t\t\thoverNode = d;\n\t\t}\n\n\t\tlet handleMouseOut = (d, i) => {\n\t\t\td3.select('#text-' + i).remove();\n\n\t\t\thovering = false;\n        }\n        \n       \n\t\t\n\t\tlet defs = svg.append('defs');\n\n\t\tmovieNodes.forEach(movieNode => {\n\t\t\tdefs.append('pattern')\n\t\t\t\t.attr('id', movieNode.title.replace(/[ ']/g, '_') + '-' + movieNode.year)\n\t\t\t\t.attr('width', 1)\n\t\t\t\t.attr('height', 1)\n\t\t\t\t.attr('x', -35)\n\t\t\t\t.attr('y', -35)\n\t\t\t\t.append('image')\n\t\t\t\t.attr('xlink:href', movieNode.poster)\n\t\t\t\t.attr('width', 200)\n\t\t\t\t.attr('height', 200)\n\t\t\t\t\n\t\t});\n\n\t\tlet node = svg.append('g')\n\t\t\t.attr('stroke', '#fff')\n\t\t\t.attr('stroke-width', 1.5)\n\t\t\t.selectAll('circle')\n\t\t\t.data(allNodes)\n\t\t\t.join('circle')\n\t\t\t.attr('r', radius)\n\t\t\t.attr('fill', fill)\n\t\t\t.on('mouseover', handleMouseOver)\n\t\t\t.on('mouseout', handleMouseOut)\n\t\t\t.call(this.drag(simulation));\n\t\t\n\t\tsimulation.on('tick', () => {\n\t\t\tlink.attr('x1', d => d.source.x)\n\t\t\t\t.attr('y1', d => d.source.y)\n\t\t\t\t.attr('x2', d => d.target.x)\n\t\t\t\t.attr('y2', d => d.target.y);\n\n\t\t\tnode.attr('cx', d => d.x)\n\t\t\t\t.attr('cy', d => d.y);\n\n\t\t\tif (hovering) {\n\t\t\t\td3.select('#' + hoverId)\n\t\t\t\t\t.attr('x', () => hoverNode.x)\n\t\t\t\t\t.attr('y', () => hoverNode.y + 50);\n\t\t\t}\n\t\t});\n\n\t\treturn svg.node();\n\t}\n\t\n\trender() {\n        \n\t\treturn (\n            \n\t\t\t<div id=\"graph\">\n                <h1>Movies Graph </h1>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Graph;"]},"metadata":{},"sourceType":"module"}