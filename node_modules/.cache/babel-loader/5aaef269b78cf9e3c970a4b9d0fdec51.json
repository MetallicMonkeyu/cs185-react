{"ast":null,"code":"var _jsxFileName = \"/Users/shengjiayu/Documents/GitHub/cs185-react/src/Components/AddMovie.js\";\nimport React, { Component } from 'react';\nimport Axios from 'axios';\nimport { PopupboxManager, PopupboxContainer } from 'react-popupbox';\nimport 'react-popupbox/dist/react-popupbox.css';\nimport config from '../config';\n\nconst firebase = require('firebase');\n\nexport class AddMovie extends Component {\n  constructor() {\n    super();\n\n    this.loadMovies = () => {\n      if (this.state.currentList.name === 'All') {\n        let ref = firebase.database().ref('movies').orderByChild('title').limitToFirst(this.state.moviesToLoad);\n        ref.on('child_added', snapshot => {\n          let movie = snapshot.val();\n          let last = movie.title; // console.log(movie);\n\n          let movies = this.state.movies;\n          movies.push(movie);\n          this.setState({\n            'movies': movies,\n            'last': last,\n            'loaded': this.state.loaded + 1 % this.state.moviesToLoad,\n            'loading': this.state.loaded + 1 < this.state.moviesToLoad\n          });\n        });\n      }\n\n      let movieIDs = this.getIDsInList();\n      movieIDs.forEach(movieID => {\n        let ref = firebase.database().ref('movies').orderByChild('id').equalTo(movieID).limitToFirst(1);\n        ref.on('child_added', snapshot => {\n          let movie = snapshot.val();\n          let last = movie.title;\n\n          if (this.state.currentList.name !== 'All') {\n            let show = false;\n            movieIDs.forEach(movieID => {\n              if (movie.id === movieID) show = true;\n            });\n            if (!show) return;\n          }\n\n          let movies = this.state.movies;\n          movies.push(movie);\n          this.setState({\n            'movies': movies,\n            'last': last,\n            'loaded': this.state.loaded + 1 % this.state.moviesToLoad,\n            'loading': this.state.loaded + 1 < this.state.moviesToLoad\n          });\n        });\n      });\n    };\n\n    this.loadMore = () => {\n      if (this.state.loading) return;\n      this.setState({\n        loading: true,\n        loaded: 0\n      });\n      let ref = firebase.database().ref('movies').orderByChild('title').startAt(this.state.last).limitToFirst(this.state.moviesToLoad + 1);\n      let movieIDs = [];\n      if (this.state.currentList.name !== 'All') movieIDs = this.getIDsInList();\n      ref.on('child_added', snapshot => {\n        const movie = snapshot.val();\n        let duplicate = false;\n        this.state.movies.forEach(m => {\n          if (m.id === movie.id) duplicate = true;\n        });\n        if (duplicate) return;\n\n        if (this.state.currentList.name !== 'All') {\n          let show = false;\n          movieIDs.forEach(movieID => {\n            if (movie.id === movieID) show = true;\n          });\n          if (!show) return;\n        }\n\n        let movies = this.state.movies;\n        movies.push(movie);\n        let last = movie.title;\n        this.setState({\n          'movies': movies,\n          'last': last,\n          'loaded': this.state.loaded + 1 % this.state.moviesToLoad,\n          'loading': this.state.loaded + 1 < this.state.moviesToLoad\n        }); // if ()\n      });\n    };\n\n    this.addMovie = event => {\n      event.preventDefault();\n\n      if (this.state.movieID.slice(0, 2) !== 'tt' || !/^\\d+$/.test(this.state.movieID.slice(2))) {\n        const title = this.state.movieID;\n        this.setState({\n          'movieID': ''\n        });\n        Axios.get('https://www.omdbapi.com/?apikey=' + 'ec05d9ae' + '&t=' + title).then(response => {\n          if (response.data.Response === 'False') {\n            alert('Movie cannot be found! Try another one.');\n            return;\n          }\n\n          let duplicate = false;\n          this.state.movies.forEach(movie => {\n            if (movie.id === response.data.imdbID) duplicate = true;\n          });\n\n          if (duplicate) {\n            alert('Movie existed!');\n            return;\n          }\n\n          let movie = [];\n          movie.id = response.data.imdbID;\n          movie.title = response.data.Title;\n          movie.director = response.data.Director;\n          movie.year = response.data.Year;\n          movie.plot = response.data.Plot;\n          movie.rating = response.data.imdbRating;\n          movie.poster = response.data.Poster;\n          movie.actors = response.data.Actors.split(', ');\n          firebase.database().ref('movies').push().set(movie);\n        });\n        return;\n      }\n\n      const id = this.state.movieID;\n      this.setState({\n        'movieID': ''\n      });\n      let duplicate = false;\n      this.state.movies.forEach(movie => {\n        if (movie.id === id) duplicate = true;\n      });\n\n      if (duplicate) {\n        alert('Movie existed!');\n        return;\n      }\n\n      Axios.get('https://www.omdbapi.com/?apikey=' + 'ec05d9ae' + '&i=' + id).then(response => {\n        if (response.data.Response === 'False') {\n          alert('Movie not found!');\n          return;\n        }\n\n        let movie = [];\n        movie.id = id;\n        movie.title = response.data.Title;\n        movie.director = response.data.Director;\n        movie.year = response.data.Year;\n        movie.plot = response.data.Plot;\n        movie.rating = response.data.imdbRating;\n        movie.poster = response.data.Poster;\n        movie.actors = response.data.Actors.split(', ');\n        firebase.database().ref('movies').push().set(movie);\n        window.scrollTo({\n          top: document.body.scrollHeight,\n          behavior: 'smooth'\n        });\n      });\n    };\n\n    this.addList = event => {\n      event.preventDefault();\n      console.log('addList: ' + this.state.listName);\n      let listName = this.state.listName;\n      this.setState({\n        'listName': ''\n      });\n      let duplicate = false;\n      Object.entries(this.state.lists).forEach(list => {\n        if (listName.toLowerCase() === list[1].toLowerCase()) duplicate = true;\n      });\n\n      if (duplicate) {\n        alert('List already exists!');\n        return;\n      }\n\n      ;\n      let ref = firebase.database().ref('lists');\n      let listRefKey = ref.push().key;\n      let updates = {};\n      updates['/lists/' + listRefKey + '/id'] = listRefKey;\n      updates['/lists/' + listRefKey + '/name'] = listName;\n      alert('List is successfully added!');\n      firebase.database().ref().update(updates);\n    };\n\n    this.getUpdateLists = () => {\n      return Object.entries(this.state.lists).map(list => /*#__PURE__*/React.createElement(\"option\", {\n        key: list[0],\n        value: list[0],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 4\n        }\n      }, list[1]));\n    };\n\n    this.getAddToLists = id => {\n      return Object.entries(this.state.lists).map((list, i) => /*#__PURE__*/React.createElement(\"option\", {\n        key: list[0],\n        value: list[0],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 339,\n          columnNumber: 4\n        }\n      }, list[1]));\n    };\n\n    this.updateList = event => {\n      let listName = '';\n\n      if (event.target.value === '') {\n        listName = 'All';\n      } else {\n        listName = this.state.lists[event.target.value];\n      }\n\n      this.setState({\n        movies: [],\n        currentList: {\n          id: event.target.value,\n          name: listName\n        },\n        loaded: 0,\n        loading: true\n      });\n      this.forceUpdate(this.loadMovies);\n    };\n\n    this.addToList = (event, movieID, movieClass) => {\n      let listID = event.target.value;\n      let duplicate = false;\n      this.state.movieListPairs.forEach(movieListPair => {\n        let pair = movieListPair.split(' - ');\n        if (pair[0] === listID && pair[1] === movieID) duplicate = true;\n      });\n\n      if (duplicate) {\n        alert('Movie already in the selected list!');\n        return;\n      }\n\n      ;\n      let ref = firebase.database().ref('movie-lists');\n      ref.push().set({\n        [listID]: movieID\n      });\n      alert('Added ' + movieID + ' to ' + this.state.lists[event.target.value]);\n\n      if (this.state.lists[event.target.value] == \"GraphViz\") {\n        this.addToGraph(movieClass);\n        alert('Now you can find ' + movieClass.title + \" in Graph!\");\n      }\n\n      ;\n    };\n\n    this.getIDsInList = () => {\n      let movieIDs = [];\n      this.state.movieListPairs.forEach(movieListPair => {\n        if (movieListPair.search(this.state.currentList.id) > -1) {\n          movieIDs.push(movieListPair.slice((this.state.currentList.id + ' - ').length));\n        }\n      });\n      return movieIDs;\n    };\n\n    this.search = event => {\n      event.preventDefault();\n    };\n\n    this.graphContainsMovie = id => {\n      let movies = this.state.graphList;\n\n      for (let i = 0; i < movies.length; i++) {\n        if (movies[i].id === id) return true;\n      }\n\n      return false;\n    };\n\n    this.addToGraph = movie => {\n      let exists = this.graphContainsMovie(movie.id);\n\n      if (exists) {\n        let ref = firebase.database().ref('graph');\n        let removeMovie = ref.orderByChild('id').equalTo(movie.id).limitToFirst(1).on('child_added', snapshot => {\n          ref.child(snapshot.key).remove();\n        });\n        ref.off('child_added', removeMovie);\n      } else {\n        console.log(movie.title);\n        alert('Movie cannot be found! Try another one.'); // firebase.database().ref('graph').push().set(movie);\n        // button.style.display = \"none\";\n      }\n\n      this.displayLightbox(movie);\n    };\n\n    this.deleteMovie = movieID => {\n      console.log('deleteMovie');\n      let ref = firebase.database().ref('movies');\n      ref.orderByChild('id').equalTo(movieID).limitToFirst(1).on('child_added', snapshot => {\n        console.log(snapshot.key);\n        ref.child(snapshot.key).remove();\n      });\n      let movies = this.state.movies;\n      let toDelete = -1;\n      movies.forEach((movie, i) => {\n        if (movie.id === movieID) toDelete = i;\n      });\n      movies.splice(toDelete, 1);\n      this.setState({\n        movies: movies\n      });\n      PopupboxManager.close();\n    };\n\n    this.handleChange = event => {\n      this.setState({\n        [event.target.name]: event.target.value\n      });\n    };\n\n    this.lockScroll = () => {\n      document.body.style.overflow = 'hidden';\n    };\n\n    this.unlockScroll = () => {\n      document.body.style.overflow = 'inherit';\n    };\n\n    this.displayMovies = () => {\n      return this.state.movies.filter(movie => movie.title.toLowerCase().includes(this.state.searchQuery)).map(movie => /*#__PURE__*/React.createElement(\"img\", {\n        className: \"moviePoster\",\n        src: movie.poster,\n        key: movie.id,\n        alt: \"\",\n        onMouseEnter: this.dimPoster,\n        onMouseLeave: this.resetPoster,\n        onClick: this.displayLightbox.bind(this, movie),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 4\n        }\n      }));\n    };\n\n    this.displayLightbox = movie => {\n      const content = /*#__PURE__*/React.createElement(\"div\", {\n        className: \"movLightboxContainer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 482,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"movLightboxImage\",\n        src: movie.poster,\n        alt: \"\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 483,\n          columnNumber: 5\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"movLightboxContent\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 484,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 485,\n          columnNumber: 6\n        }\n      }, movie.title), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 487,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"span\", {\n        className: \"director\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 488,\n          columnNumber: 6\n        }\n      }, \"Directed by: \", /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 488,\n          columnNumber: 48\n        }\n      }, movie.director)), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 489,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 490,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 491,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 492,\n          columnNumber: 6\n        }\n      }, movie.plot), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 493,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 494,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"span\", {\n        className: \"rating\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 495,\n          columnNumber: 6\n        }\n      }, \"Rating: \", /*#__PURE__*/React.createElement(\"b\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 495,\n          columnNumber: 41\n        }\n      }, movie.rating)), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 496,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 497,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 498,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"select\", {\n        className: \"dropdown\",\n        value: this.state.addToListName,\n        onChange: event => {\n          this.addToList(event, movie.id, movie);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 499,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        hidden: true,\n        value: \"\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 500,\n          columnNumber: 8\n        }\n      }, \"Add to List\"), this.getAddToLists(movie.id))), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 508,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 509,\n          columnNumber: 6\n        }\n      }), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"add-to-graph-button\",\n        onClick: () => this.addToGraph(movie),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 510,\n          columnNumber: 6\n        }\n      }, this.graphContainsMovie(movie.id) ? 'Remove from Graph' : 'Add to Graph'), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 513,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"delete-button-add\",\n        onClick: () => {\n          this.deleteMovie(movie.id);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 514,\n          columnNumber: 25\n        }\n      }, \"Delete From Collection\"))));\n      PopupboxManager.open({\n        content,\n        config: {\n          onOpen: this.lockScroll,\n          onClosed: this.unlockScroll\n        }\n      });\n    };\n\n    this.state = {\n      movies: [],\n      moviesToLoad: 8,\n      last: '',\n      loaded: 0,\n      loading: true,\n      movieID: '',\n      listName: '',\n      lists: {},\n      movieListPairs: [],\n      addToListName: 'Add to List',\n      currentList: {\n        id: '',\n        name: 'All'\n      },\n      searchQuery: '',\n      graphList: [],\n      maxLoaded: false\n    };\n    this.wrapper = React.createRef();\n    this.setState({\n      loading: false\n    });\n  }\n\n  componentDidMount() {\n    document.title = 'Categorized Movies';\n\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    this.loadMovies();\n    let ref = firebase.database().ref('lists');\n    ref.orderByChild('name').on('value', snapshot => {\n      if (!snapshot.val()) return;\n      let lists = {};\n      Object.values(snapshot.val()).forEach(list => {\n        lists[list.id] = list.name;\n      });\n      this.setState({\n        lists: lists\n      });\n    }); //new\n\n    ref = firebase.database().ref('movie-lists');\n    ref.orderByKey().on('value', snapshot => {\n      if (!snapshot.val()) return;\n      let movieLists = [];\n      Object.values(snapshot.val()).forEach(movieListPair => {\n        let pair = Object.entries(movieListPair)[0];\n        movieLists.push(pair[0] + ' - ' + pair[1]);\n      });\n      this.setState({\n        movieListPairs: movieLists\n      });\n    });\n    ref = firebase.database().ref('graph');\n    ref.on('child_added', snapshot => {\n      let movie = snapshot.val();\n      let movies = this.state.graphList;\n      movies.push(movie);\n      this.setState({\n        'graphList': movies\n      });\n    });\n    ref.on('child_removed', snapshot => {\n      let movie = snapshot.val();\n      let movies = this.state.graphList;\n\n      for (let i = 0; i < movies.length; i++) {\n        if (movies[i].id === movie.id) {\n          movies.splice(i, 1);\n          break;\n        }\n      }\n\n      this.setState({\n        'graphList': movies\n      });\n    }); //new\n  } // componentWillUnmount() {\n  //     this.;\n  // }\n\n\n  dimPoster(e) {\n    e.target.style.opacity = 0.5;\n  }\n\n  resetPoster(e) {\n    e.target.style.opacity = 1;\n  }\n\n  render() {\n    const popupboxConfig = {\n      style: {\n        overflow: 'inherit'\n      }\n    };\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 539,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 540,\n        columnNumber: 5\n      }\n    }, \"Movies Collection \"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"movie-forms\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 542,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"dropdown\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 543,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"select\", {\n      onChange: this.updateList,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 544,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"option\", {\n      value: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 545,\n        columnNumber: 9\n      }\n    }, \"All\"), this.getUpdateLists())), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"movie-add-forms\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 554,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      className: \"movie-form\",\n      onSubmit: e => this.addMovie(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 556,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 557,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      name: \"movieID\",\n      className: \"form-input-text\",\n      value: this.state.movieID,\n      onChange: e => this.handleChange(e),\n      placeholder: \"Movie title or IMDB ID\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 558,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"Add a Movie\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 565,\n        columnNumber: 33\n      }\n    }))), /*#__PURE__*/React.createElement(\"form\", {\n      className: \"movie-form\",\n      onSubmit: e => this.addList(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 569,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 570,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      name: \"listName\",\n      className: \"form-input-text\",\n      value: this.state.listName,\n      onChange: e => this.handleChange(e),\n      placeholder: \"Enter a new list name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 571,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"Create List\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 577,\n        columnNumber: 33\n      }\n    }))), /*#__PURE__*/React.createElement(\"form\", {\n      className: \"movie-form\",\n      onSubmit: e => this.search(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 581,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 582,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 583,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 583,\n        columnNumber: 32\n      }\n    }, \"Search By Name: \")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 584,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      name: \"searchQuery\",\n      className: \"form-input-text\",\n      value: this.state.searchQuery,\n      onChange: e => this.handleChange(e),\n      placeholder: \"Enter a name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 585,\n        columnNumber: 8\n      }\n    }))))), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 599,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"movies\",\n      ref: this.moviesScroll,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 602,\n        columnNumber: 5\n      }\n    }, this.displayMovies(), /*#__PURE__*/React.createElement(PopupboxContainer, Object.assign({}, popupboxConfig, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 606,\n        columnNumber: 6\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"button\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 608,\n        columnNumber: 17\n      }\n    }, !this.state.loading && /*#__PURE__*/React.createElement(\"button\", {\n      className: \"but\",\n      onClick: this.loadMore,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 609,\n        columnNumber: 43\n      }\n    }, \"Load More ...\")));\n  }\n\n}\nexport default AddMovie;","map":{"version":3,"sources":["/Users/shengjiayu/Documents/GitHub/cs185-react/src/Components/AddMovie.js"],"names":["React","Component","Axios","PopupboxManager","PopupboxContainer","config","firebase","require","AddMovie","constructor","loadMovies","state","currentList","name","ref","database","orderByChild","limitToFirst","moviesToLoad","on","snapshot","movie","val","last","title","movies","push","setState","loaded","movieIDs","getIDsInList","forEach","movieID","equalTo","show","id","loadMore","loading","startAt","duplicate","m","addMovie","event","preventDefault","slice","test","get","then","response","data","Response","alert","imdbID","Title","director","Director","year","Year","plot","Plot","rating","imdbRating","poster","Poster","actors","Actors","split","set","window","scrollTo","top","document","body","scrollHeight","behavior","addList","console","log","listName","Object","entries","lists","list","toLowerCase","listRefKey","key","updates","update","getUpdateLists","map","getAddToLists","i","updateList","target","value","forceUpdate","addToList","movieClass","listID","movieListPairs","movieListPair","pair","addToGraph","search","length","graphContainsMovie","graphList","exists","removeMovie","child","remove","off","displayLightbox","deleteMovie","toDelete","splice","close","handleChange","lockScroll","style","overflow","unlockScroll","displayMovies","filter","includes","searchQuery","dimPoster","resetPoster","bind","content","addToListName","open","onOpen","onClosed","maxLoaded","wrapper","createRef","componentDidMount","apps","initializeApp","values","orderByKey","movieLists","e","opacity","render","popupboxConfig","moviesScroll"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Axios from 'axios';\nimport { PopupboxManager, PopupboxContainer } from 'react-popupbox';\nimport 'react-popupbox/dist/react-popupbox.css'; \nimport config from '../config';\n\nconst firebase = require('firebase');\n\nexport class AddMovie extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.state = {\n\t\t\tmovies: [],\n\t\t\tmoviesToLoad: 8,\n\t\t\tlast: '',\n\t\t\tloaded: 0,\n\t\t\tloading: true,\n\t\t\tmovieID: '',\n\t\t\tlistName: '',\n\t\t\tlists: {},\n\t\t\tmovieListPairs: [],\n\t\t\taddToListName: 'Add to List',\n\t\t\tcurrentList: {id: '', name: 'All'},\n\t\t\tsearchQuery: '',\n            graphList: [],\n            maxLoaded: false\n\t\t};\n\t\tthis.wrapper = React.createRef();\n\n        this.setState({loading:false});\n\t}\n\n\tcomponentDidMount() {\n        document.title = 'Categorized Movies';\n\t\tif (!firebase.apps.length) {\n\t\t\tfirebase.initializeApp(config);\n\t\t}\n\n\t\tthis.loadMovies();\n\n\t\tlet ref = firebase.database().ref('lists');\n\t\tref.orderByChild('name').on('value', snapshot => {\n\t\t\tif (!snapshot.val()) return;\n\t\t\t\n\t\t\tlet lists = {};\n\t\t\t\n\t\t\tObject.values(snapshot.val()).forEach(list => {\n\t\t\t\tlists[list.id] = list.name;\n\t\t\t});\n\n\t\t\tthis.setState({\n\t\t\t\tlists: lists\n\t\t\t});\n\t\t});\n\n\t\t//new\n\t\tref = firebase.database().ref('movie-lists');\n\t\tref.orderByKey().on('value', snapshot => {\n\t\t\tif (!snapshot.val()) return;\n\t\t\t\n\t\t\tlet movieLists = [];\n\n\t\t\tObject.values(snapshot.val()).forEach(movieListPair => {\n\t\t\t\tlet pair = Object.entries(movieListPair)[0];\n\t\t\t\tmovieLists.push(pair[0] + ' - ' + pair[1]);\n\t\t\t});\n\n\t\t\tthis.setState({\n\t\t\t\tmovieListPairs: movieLists\n\t\t\t});\n\t\t});\n\t\tref = firebase.database().ref('graph');\n\t\tref.on('child_added', snapshot => {\n\t\t\tlet movie = snapshot.val();\n\n\t\t\tlet movies = this.state.graphList;\n\t\t\tmovies.push(movie);\n\n\t\t\tthis.setState({\n\t\t\t\t'graphList': movies\n\t\t\t});\n\t\t});\n\t\tref.on('child_removed', snapshot => {\n\t\t\tlet movie = snapshot.val();\n\n\t\t\tlet movies = this.state.graphList;\n\t\t\tfor (let i = 0; i < movies.length; i++) {\n\t\t\t\tif (movies[i].id === movie.id) {\n\t\t\t\t\tmovies.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setState({\n\t\t\t\t'graphList': movies\n\t\t\t});\n\n\t\t});\n\t\t//new\n\n\n    }\n    // componentWillUnmount() {\n    //     this.;\n    // }\n\n\tloadMovies = () => {\n\t\tif (this.state.currentList.name === 'All') {\n\t\t\tlet ref = firebase.database()\n\t\t\t\t.ref('movies')\n\t\t\t\t.orderByChild('title')\n\t\t\t\t.limitToFirst(this.state.moviesToLoad);\n\t\t\t\n\t\t\tref.on('child_added', snapshot => {\n\t\t\t\tlet movie = snapshot.val();\n\t\t\t\tlet last = movie.title;\n\t\t\t\t// console.log(movie);\n\n\t\t\t\tlet movies = this.state.movies;\n\t\t\t\tmovies.push(movie);\n\n\t\t\t\tthis.setState({\n\t\t\t\t\t'movies': movies,\n\t\t\t\t\t'last': last,\n\t\t\t\t\t'loaded': this.state.loaded + 1 % this.state.moviesToLoad,\n\t\t\t\t\t'loading': this.state.loaded + 1 < this.state.moviesToLoad\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tlet movieIDs = this.getIDsInList();\n\t\t\n\t\tmovieIDs.forEach(movieID => {\n\t\t\tlet ref = firebase.database()\n\t\t\t\t.ref('movies')\n\t\t\t\t.orderByChild('id')\n\t\t\t\t.equalTo(movieID)\n\t\t\t\t.limitToFirst(1);\n\n\t\t\tref.on('child_added', snapshot => {\n\t\t\t\tlet movie = snapshot.val();\n\t\t\t\tlet last = movie.title;\n\t\n\t\t\t\tif (this.state.currentList.name !== 'All') {\n\t\t\t\t\tlet show = false;\n\t\t\t\t\tmovieIDs.forEach(movieID => {\n\t\t\t\t\t\tif (movie.id === movieID) show = true;\n\t\t\t\t\t});\n\t\t\t\t\tif (!show) return;\n\t\t\t\t}\n\t\n\t\t\t\tlet movies = this.state.movies;\n\t\t\t\tmovies.push(movie);\n\t\n\t\t\t\tthis.setState({\n\t\t\t\t\t'movies': movies,\n\t\t\t\t\t'last': last,\n\t\t\t\t\t'loaded': this.state.loaded + 1 % this.state.moviesToLoad,\n\t\t\t\t\t'loading': this.state.loaded + 1 < this.state.moviesToLoad\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tloadMore = () => {\n\t\tif (this.state.loading) return;\n\t\t\n\t\tthis.setState({\n\t\t\tloading: true,\n\t\t\tloaded: 0\n\t\t});\n\t\t\n\t\tlet ref = firebase.database()\n\t\t\t.ref('movies')\n\t\t\t.orderByChild('title')\n\t\t\t.startAt(this.state.last)\n\t\t\t.limitToFirst(this.state.moviesToLoad + 1);\n\n\t\tlet movieIDs = [];\n\t\tif (this.state.currentList.name !== 'All') movieIDs = this.getIDsInList();\n\n\t\tref.on('child_added', snapshot => {\n\t\t\tconst movie = snapshot.val();\n\n\t\t\tlet duplicate = false;\n\t\t\tthis.state.movies.forEach(m => {\n\t\t\t\tif (m.id === movie.id) duplicate = true;\n\t\t\t});\n\t\t\tif (duplicate) return;\n\n\t\t\tif (this.state.currentList.name !== 'All') {\n\t\t\t\tlet show = false;\n\t\t\t\tmovieIDs.forEach(movieID => {\n\t\t\t\t\tif (movie.id === movieID) show = true;\n\t\t\t\t});\n\t\t\t\tif (!show) return;\n\t\t\t}\n\n\t\t\tlet movies = this.state.movies;\n\t\t\tmovies.push(movie);\n\n\t\t\tlet last = movie.title;\n\n\t\t\tthis.setState({\n\t\t\t\t'movies': movies,\n\t\t\t\t'last': last,\n\t\t\t\t'loaded': this.state.loaded + 1 % this.state.moviesToLoad,\n\t\t\t\t'loading': this.state.loaded + 1 < this.state.moviesToLoad\n            });\n            // if ()\n\t\t});\n\t}\n\n\taddMovie = (event) => {\n\t\tevent.preventDefault();\n\t\t\n\t\tif (this.state.movieID.slice(0, 2) !== 'tt' || !/^\\d+$/.test(this.state.movieID.slice(2))) {\n\t\t\tconst title = this.state.movieID;\n\n\t\t\tthis.setState({\n\t\t\t\t'movieID': ''\n\t\t\t});\n\n\t\t\tAxios.get('https://www.omdbapi.com/?apikey=' + 'ec05d9ae' + '&t=' + title)\n\t\t\t.then(response => {\n\t\t\t\tif (response.data.Response === 'False') {\n\t\t\t\t\talert('Movie cannot be found! Try another one.');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet duplicate = false;\n\t\t\t\tthis.state.movies.forEach(movie => {\n\t\t\t\t\tif (movie.id === response.data.imdbID) duplicate = true;\n\t\t\t\t});\n\n\t\t\t\tif (duplicate) {\n\t\t\t\t\talert('Movie existed!');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet movie = [];\n\t\t\t\tmovie.id = response.data.imdbID;\n\t\t\t\tmovie.title = response.data.Title;\n\t\t\t\tmovie.director = response.data.Director;\n\t\t\t\tmovie.year = response.data.Year;\n\t\t\t\tmovie.plot = response.data.Plot;\n\t\t\t\tmovie.rating = response.data.imdbRating;\n\t\t\t\tmovie.poster = response.data.Poster;\n\t\t\t\tmovie.actors = response.data.Actors.split(', ');\n\n                firebase.database().ref('movies').push().set(movie);\n\t\t\t\t\n\t\t\t});\n            \n\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = this.state.movieID;\n\n\t\tthis.setState({\n\t\t\t'movieID': ''\n\t\t});\n\t\t\n\t\tlet duplicate = false;\n\t\tthis.state.movies.forEach(movie => {\n\t\t\tif (movie.id === id) duplicate = true;\n\t\t});\n\n\t\tif (duplicate) {\n\t\t\talert('Movie existed!');\n\t\t\treturn;\n\t\t}\n\n\n\t\tAxios.get('https://www.omdbapi.com/?apikey=' + 'ec05d9ae' + '&i=' + id)\n\t\t.then(response => {\n\t\t\tif (response.data.Response === 'False') {\n\t\t\t\talert('Movie not found!');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet movie = [];\n\t\t\tmovie.id = id;\n\t\t\tmovie.title = response.data.Title;\n\t\t\tmovie.director = response.data.Director;\n\t\t\tmovie.year = response.data.Year;\n\t\t\tmovie.plot = response.data.Plot;\n            movie.rating = response.data.imdbRating;\n\t\t\tmovie.poster = response.data.Poster;\n\t\t\tmovie.actors = response.data.Actors.split(', ');\n            firebase.database().ref('movies').push().set(movie);\n            window.scrollTo({\n                top: document.body.scrollHeight,\n                behavior: 'smooth'\n            });\n\n\t\t});\n\t}\n\n\taddList = (event) => {\n\t\tevent.preventDefault();\n\t\tconsole.log('addList: ' + this.state.listName);\n\t\t\n\t\tlet listName = this.state.listName;\n\t\t\n\t\tthis.setState({\n\t\t\t'listName': ''\n\t\t});\n\n\t\tlet duplicate = false;\n\t\tObject.entries(this.state.lists).forEach(list => {\n\t\t\tif (listName.toLowerCase() === list[1].toLowerCase()) duplicate = true;\n\t\t});\n\t\tif (duplicate) {\n\t\t\talert('List already exists!');\n\t\t\treturn;\n\t\t};\n\t\t\n\t\tlet ref = firebase.database().ref('lists');\n\t\tlet listRefKey = ref.push().key;\n\t\t\n\t\tlet updates = {};\n\t\tupdates['/lists/' + listRefKey + '/id'] = listRefKey;\n\t\tupdates['/lists/' + listRefKey + '/name'] = listName;\n        alert('List is successfully added!');\n\t\tfirebase.database().ref().update(updates);\n\t}\n\n\tgetUpdateLists = () => {\n\t\treturn Object.entries(this.state.lists).map(list => (\n\t\t\t<option key={list[0]}\n\t\t\t\tvalue={list[0]}>{list[1]}</option>\n\t\t));\n\t}\n\n\tgetAddToLists = (id) => {\n\t\treturn Object.entries(this.state.lists).map((list, i) => (\n\t\t\t<option key={list[0]}\n\t\t\t\tvalue={list[0]}>{list[1]}</option>\n\t\t));\n\t}\n\n\tupdateList = (event) => {\n\t\tlet listName = '';\n\t\tif (event.target.value === '') {\n\t\t\tlistName = 'All';\n\t\t} else {\n\t\t\tlistName = this.state.lists[event.target.value];\n\t\t}\n\n\t\tthis.setState({\n\t\t\tmovies: [],\n\t\t\tcurrentList: {id: event.target.value, name: listName},\n\t\t\tloaded: 0,\n\t\t\tloading: true\n\t\t});\n\n\t\tthis.forceUpdate(this.loadMovies);\n\t}\n\n\taddToList = (event, movieID, movieClass) => {\n\t\tlet listID = event.target.value;\n\t\tlet duplicate = false;\n\t\tthis.state.movieListPairs.forEach(movieListPair => {\n\t\t\tlet pair = movieListPair.split(' - ');\n\t\t\tif (pair[0] === listID && pair[1] === movieID) duplicate = true;\n\t\t});\n\t\tif (duplicate) {\n\t\t\talert('Movie already in the selected list!');\n\t\t\treturn;\n\t\t};\n\t\t\n\t\tlet ref = firebase.database().ref('movie-lists');\n\t\tref.push().set({[listID]: movieID});\n\t\talert('Added ' + movieID + ' to ' +  this.state.lists[event.target.value]);\n\t\t\n\t\tif (this.state.lists[event.target.value] == \"GraphViz\"){\n\t\t\tthis.addToGraph(movieClass)\n\t\t\talert('Now you can find ' + movieClass.title + \" in Graph!\" );\n\t\t};\n\t\t\n\t}\n\n\tgetIDsInList = () => {\n\t\tlet movieIDs = [];\n\t\tthis.state.movieListPairs.forEach(movieListPair => {\n\t\t\tif (movieListPair.search(this.state.currentList.id) > -1) {\n\t\t\t\tmovieIDs.push(movieListPair.slice((this.state.currentList.id + ' - ').length));\n\t\t\t}\n\t\t});\n\n\t\treturn movieIDs;\n\t}\n\n\tsearch = (event) => {\n\t\tevent.preventDefault();\n\t}\n\n\tgraphContainsMovie = (id) => {\n\t\tlet movies = this.state.graphList;\n\t\tfor (let i = 0; i < movies.length; i++) {\n\t\t\tif (movies[i].id === id) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\taddToGraph = (movie) => {\t\t\n\t\tlet exists = this.graphContainsMovie(movie.id);\n\t\t\n\t\tif (exists) {\n\t\t\tlet ref = firebase.database().ref('graph');\n\t\t\tlet removeMovie = ref.orderByChild('id').equalTo(movie.id).limitToFirst(1).on('child_added', snapshot => {\n\t\t\t\tref.child(snapshot.key).remove();\n\t\t\t});\n\t\t\tref.off('child_added', removeMovie);\n\t\t} else {\n\t\t\tconsole.log(movie.title);\n\t\t\talert('Movie cannot be found! Try another one.');\n\n\t\t\t// firebase.database().ref('graph').push().set(movie);\n\t\t\t// button.style.display = \"none\";\n\t\t}\n\t\tthis.displayLightbox(movie);\n\t}\n\n\tdeleteMovie = (movieID) => {\n\t\tconsole.log('deleteMovie');\n\t\tlet ref = firebase.database().ref('movies');\n\t\t\n\t\tref.orderByChild('id').equalTo(movieID).limitToFirst(1).on('child_added', snapshot => {\n\t\t\tconsole.log(snapshot.key);\n\t\t\tref.child(snapshot.key).remove();\n\t\t});\n\n\t\tlet movies = this.state.movies;\n\t\t\n\t\tlet toDelete = -1;\n\t\tmovies.forEach((movie, i) => {\n\t\t\tif (movie.id === movieID) toDelete = i;\n\t\t});\n\t\tmovies.splice(toDelete, 1);\n\n\t\tthis.setState({movies: movies});\n\n\t\tPopupboxManager.close();\n\t}\n\n\thandleChange = (event) => {\n\t\tthis.setState({\n\t\t\t[event.target.name]: event.target.value\n\t\t});\n\t}\n\n\tlockScroll = () => {\n\t\tdocument.body.style.overflow = 'hidden';\n\t}\n\n\tunlockScroll = () => {\n\t\tdocument.body.style.overflow = 'inherit';\n    }\n    dimPoster(e) {\n        e.target.style.opacity = 0.5;\n      }\n    \n    resetPoster(e) {\n        e.target.style.opacity = 1;\n    }\n\n\tdisplayMovies = () => {\n\t\treturn this.state.movies.filter(movie => movie.title.toLowerCase().includes(this.state.searchQuery)).map(movie => (\n\t\t\t<img className=\"moviePoster\" src={movie.poster}\n                key={movie.id} alt=\"\"\n                onMouseEnter={this.dimPoster} onMouseLeave={this.resetPoster}\n\t\t\t\tonClick={this.displayLightbox.bind(this, movie)}/>\n\t\t));\n\t}\n\n\tdisplayLightbox = (movie) => {\n\t\tconst content = (\n\t\t\t\n            <div className=\"movLightboxContainer\">\n\t\t\t\t<img className=\"movLightboxImage\" src={movie.poster} alt=\"\"/>\n\t\t\t\t<div className = \"movLightboxContent\">\n\t\t\t\t\t<span className = \"title\">{movie.title}</span>\n\t\t\t\t\t<br></br>\n\t\t\t\t\t<br></br>\n\t\t\t\t\t<span className = \"director\">Directed by: <b>{movie.director}</b></span>\n\t\t\t\t\t<br></br>\n\t\t\t\t\t<br></br>\n\t\t\t\t\t<br></br>\n\t\t\t\t\t<p>{movie.plot}</p>\n\t\t\t\t\t<br></br>\n\t\t\t\t\t<br></br>\n\t\t\t\t\t<span className = \"rating\">Rating: <b>{movie.rating}</b></span>\n                    <br></br>\n\t\t\t\t\t<br></br>\n                    <div>\n\t\t\t\t\t\t<select className=\"dropdown\" value={this.state.addToListName} onChange={event => {this.addToList(event, movie.id, movie)}}>\n\t\t\t\t\t\t\t<option hidden value=\"\">Add to List</option>\n                             {this.getAddToLists(movie.id)}\n                             \n                        </select>\n                        \n                        \n\t\t\t \t\t\t\n\t\t\t \t\t</div>\n                    <br></br>\n\t\t\t\t\t<br></br>\n\t\t\t\t\t<button className=\"add-to-graph-button\" onClick={() => this.addToGraph(movie)}>\n\t\t\t\t\t\t\t{this.graphContainsMovie(movie.id) ? 'Remove from Graph' : 'Add to Graph'}\n\t\t\t\t\t</button>\n                    <div>\n                        <button className=\"delete-button-add\" onClick={() => {this.deleteMovie(movie.id)}}>Delete From Collection</button>\n                    </div>\n\t\n\t\t\t\t</div>\n\t\t\t\n\t\t\t</div>\n\t\t)\n\n\t\tPopupboxManager.open({content,\n\t\t\tconfig: {\n\t\t\t\tonOpen: this.lockScroll,\n\t\t\t\tonClosed: this.unlockScroll\n\t\t\t}\n\t\t});\n    }\n\n\n\trender() {\n\t\tconst popupboxConfig = {\n\t\t\tstyle: {\n\t\t\t\toverflow: 'inherit'\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<h1>Movies Collection </h1>\n\t\t\t\t\n\t\t\t\t<div className=\"movie-forms\">\n                    <div className=\"dropdown\">\n\t\t\t\t\t\t\t<select  onChange={this.updateList} >\n\t\t\t\t\t\t\t\t<option value=\"\">All</option>\n                                {this.getUpdateLists()}\n                                \n                            </select>\n                            \n                        \n                            \n                            \n\t\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"movie-add-forms\">\n                        \n\t\t\t\t\t\t<form className=\"movie-form\" onSubmit={e => this.addMovie(e)}>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\t\t\t\tname=\"movieID\"\n\t\t\t\t\t\t\t\t\tclassName=\"form-input-text\"\n\t\t\t\t\t\t\t\t\tvalue={this.state.movieID}\n\t\t\t\t\t\t\t\t\tonChange={e => this.handleChange(e)}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Movie title or IMDB ID\"/>\n                                \n                                <input type='submit' value='Add a Movie'/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</form>\n\n\t\t\t\t\t\t<form className=\"movie-form\" onSubmit={e => this.addList(e)}>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\t\t\t\tname=\"listName\"\n\t\t\t\t\t\t\t\t\tclassName=\"form-input-text\"\n\t\t\t\t\t\t\t\t\tvalue={this.state.listName}\n\t\t\t\t\t\t\t\t\tonChange={e => this.handleChange(e)}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Enter a new list name\"/>\n                                <input type='submit' value='Create List'/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<form className=\"movie-form\" onSubmit={e => this.search(e)}>\n\t\t\t\t\t\t<div>\n                        <label><span>Search By Name: </span></label>\n                        <div>\n\t\t\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\t\t\tname=\"searchQuery\"\n\t\t\t\t\t\t\t\tclassName=\"form-input-text\"\n\t\t\t\t\t\t\t\tvalue={this.state.searchQuery}\n\t\t\t\t\t\t\t\tonChange={e => this.handleChange(e)}\n\t\t\t\t\t\t\t\tplaceholder=\"Enter a name\"/>\n                        </div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\n\t\t\t\t\t<div></div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div className=\"movies\"\n\t\t\t\t\tref={this.moviesScroll}>\n\t\t\t\t\t{this.displayMovies()}\n\n\t\t\t\t\t<PopupboxContainer { ...popupboxConfig } />\n\t\t\t\t</div>\n                <div className='button'>\n                {!(this.state.loading) && <button className = 'but' onClick={this.loadMore}>Load More ...</button>}\n                </div>\n\t\t\t</div>\n\n\t\t);\n\t}\n}\n\nexport default AddMovie;"]},"metadata":{},"sourceType":"module"}