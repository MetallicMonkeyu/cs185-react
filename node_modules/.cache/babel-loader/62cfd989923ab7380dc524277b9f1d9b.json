{"ast":null,"code":"import _classCallCheck from\"/Users/shengjiayu/Documents/GitHub/cs185-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/shengjiayu/Documents/GitHub/cs185-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/shengjiayu/Documents/GitHub/cs185-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/shengjiayu/Documents/GitHub/cs185-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import*as d3 from'd3';import config from'../config';var firebase=require('firebase');export var Graph=/*#__PURE__*/function(_Component){_inherits(Graph,_Component);var _super=_createSuper(Graph);function Graph(){var _this;_classCallCheck(this,Graph);_this=_super.call(this);_this.drag=function(simulation){function dragStarted(d){if(!d3.event.active)simulation.alphaTarget(0.3).restart();d.fx=d.x;d.fy=d.y;}function dragged(d){d.fx=d3.event.x;d.fy=d3.event.y;}function dragEnded(d){if(!d3.event.active){simulation.alphaTarget(0);}d.fx=null;d.fy=null;}return d3.drag().on('start',dragStarted).on('drag',dragged).on('end',dragEnded);};_this.createGraph=function(){var headerOffset=document.getElementsByClassName('header')[0].offsetHeight;var navbarOffset=document.getElementsByClassName('navheader')[0].offsetHeight;var width=window.innerWidth*1.6;var height=(window.innerHeight-headerOffset-navbarOffset)*1.6;var allNodes=_this.state.movies.concat(_this.state.actors);var mvNode=_this.state.movies;var links=_this.state.links;var svg=d3.create('svg').attr('viewBox',[0,0,width,height]);var simulation=d3.forceSimulation(allNodes).force('link',d3.forceLink().links(links).id(function(d){return d.index;}).distance(200)).force('repel',d3.forceManyBody()).force('attract',d3.forceManyBody()).force('center',d3.forceCenter(width/2,height/2));var link=svg.append('g').attr('stroke','#777').attr('stroke-opacity',1).selectAll('line').data(links).join('line').attr('stroke-width',2);var radius=function radius(node){if(node.type==='actor'){return 25;}return 100;};var fill=function fill(node){if(node.type==='movie'){console.log('url(#'+node.title.replace(/[ ']/g,'_')+'-'+node.year+')');return'url(#'+node.title.replace(/[ ']/g,'_')+'-'+node.year+')';}return d3.color('rgb(191, 215, 228)');};var defs=svg.append('defs');mvNode.forEach(function(movieNode){defs.append('pattern').attr('id',movieNode.title.replace(/[ ']/g,'_')+'-'+movieNode.year).attr('width',1).attr('height',1).attr('x',-35).attr('y',-35).append('image').attr('xlink:href',movieNode.poster).attr('width',200).attr('height',200);});var tooltip=d3.select('body').append('div').style('position','absolute').style('z-index','10').style('visibility','hidden');var node=svg.append('g').attr('stroke','#fff').attr('stroke-width',1.5).selectAll('circle').data(allNodes).join('circle').attr('r',radius).attr('fill',fill).on('mouseover',function(node){if(node.type==='actor'){tooltip.text(node.name);tooltip.style('visibility','visible');tooltip.style('top',d3.event.y-20+'px').style('left',d3.event.x+20+'px');}}).on('mouseout',function(){return tooltip.style('visibility','hidden');}).call(_this.drag(simulation));simulation.on('tick',function(){link.attr('x1',function(d){return d.source.x;}).attr('y1',function(d){return d.source.y;}).attr('x2',function(d){return d.target.x;}).attr('y2',function(d){return d.target.y;});node.attr('cx',function(d){return d.x;}).attr('cy',function(d){return d.y;});});return svg.node();};_this.state={movies:[],actors:[],links:[]};_this.graph=React.createRef();return _this;}_createClass(Graph,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;if(!firebase.apps.length){firebase.initializeApp(config);}var mvNode=[];var acNode=[];var links=[];var ref=firebase.database().ref('graph');ref.on('value',function(snapshot){if(!snapshot.val())return;var movies=snapshot.val();console.log(movies);for(var entry in movies){if(movies[entry].lists==='GraphViz'){console.log(\"Found list\");}console.log(\"Not Found list\");}var moviesLength=Object.values(movies).length;console.log(moviesLength);Object.values(movies).forEach(function(movie){movie.type='movie';console.log(movie);mvNode.push(movie);movie.actors.forEach(function(actor){var exists=false;var index=-1;for(var i=0;i<acNode.length;i++){var n=acNode[i];if(n.name===actor){exists=true;index=i;break;}}var link={};if(exists){link={source:mvNode.length-1,target:moviesLength+index};}else{var node={name:actor,type:'actor'};acNode.push(node);link={source:mvNode.length-1,target:moviesLength+acNode.length-1};}links.push(link);});});mvNode=_this2.state.movies.concat(mvNode);acNode=_this2.state.actors.concat(acNode);links=_this2.state.links.concat(links);_this2.setState({'movies':mvNode,'actors':acNode,'links':links},function(){var element=document.getElementById('graph');element.appendChild(this.createGraph());});});}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{id:\"graph\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Movies Graph \"));}}]);return Graph;}(Component);export default Graph;","map":{"version":3,"sources":["/Users/shengjiayu/Documents/GitHub/cs185-react/src/Components/Graph.js"],"names":["React","Component","d3","config","firebase","require","Graph","drag","simulation","dragStarted","d","event","active","alphaTarget","restart","fx","x","fy","y","dragged","dragEnded","on","createGraph","headerOffset","document","getElementsByClassName","offsetHeight","navbarOffset","width","window","innerWidth","height","innerHeight","allNodes","state","movies","concat","actors","mvNode","links","svg","create","attr","forceSimulation","force","forceLink","id","index","distance","forceManyBody","forceCenter","link","append","selectAll","data","join","radius","node","type","fill","console","log","title","replace","year","color","defs","forEach","movieNode","poster","tooltip","select","style","text","name","call","source","target","graph","createRef","apps","length","initializeApp","acNode","ref","database","snapshot","val","entry","lists","moviesLength","Object","values","movie","push","actor","exists","i","n","setState","element","getElementById","appendChild"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport config from '../config';\n\nconst firebase = require('firebase');\n\nexport class Graph extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.state = {\n\t\t\tmovies: [],\n\t\t\tactors: [],\n\t\t\tlinks: []\n\t\t}\n\t\tthis.graph = React.createRef();\n\t}\n\n\tdrag = (simulation) => {\n\t\tfunction dragStarted(d) {\n\t\t\tif (!d3.event.active) simulation.alphaTarget(0.3).restart();\n\t\t\td.fx = d.x;\n\t\t\td.fy = d.y;\n\t\t}\n\n\t\tfunction dragged(d) {\n\t\t\td.fx = d3.event.x;\n\t\t\td.fy = d3.event.y;\n\t\t}\n\n\t\tfunction dragEnded(d) {\n\t\t\tif (!d3.event.active){\n                simulation.alphaTarget(0);\n            } \n\t\t\td.fx = null;\n\t\t\td.fy = null;\n\t\t}\n\n\t\treturn d3.drag()\n\t\t\t.on('start', dragStarted)\n\t\t\t.on('drag', dragged)\n\t\t\t.on('end', dragEnded);\n\t}\n\n\tcreateGraph = () => {\n        const headerOffset = document.getElementsByClassName('header')[0].offsetHeight;\n        const navbarOffset = document.getElementsByClassName('navheader')[0].offsetHeight;\n\t\tconst width = window.innerWidth*1.6;\n        const height = (window.innerHeight-headerOffset-navbarOffset)*1.6;\n\n\t\tlet allNodes = this.state.movies.concat(this.state.actors);\n\t\tlet mvNode = this.state.movies;\n\t\tlet links = this.state.links;\n\n\t\tlet svg = d3.create('svg').attr('viewBox', [0, 0, width, height]);\n\t\t\n\n            \n        let simulation = d3.forceSimulation(allNodes)\n            .force('link', d3.forceLink().links(links).id(d => { return d.index; }).distance(200))\n            .force('repel', d3.forceManyBody())\n            .force('attract', d3.forceManyBody())\n            .force('center', d3.forceCenter(width/2, height/2));\n\n\t\tlet link = svg.append('g')\n\t\t\t.attr('stroke', '#777')\n\t\t\t.attr('stroke-opacity', 1)\n\t\t\t.selectAll('line')\n\t\t\t.data(links)\n\t\t\t.join('line')\n\t\t\t.attr('stroke-width', 2);\n\n\t\tlet radius = (node) => {\n\t\t\tif(node.type === 'actor') {\n                return 25;\n              } \n              return 100;\n        }\n        \n\t\tlet fill = (node) => {\n            if (node.type === 'movie'){\n                console.log('url(#' + node.title.replace(/[ ']/g, '_') + '-' + node.year + ')');\n                return 'url(#' + node.title.replace(/[ ']/g, '_') + '-' + node.year + ')';\n            }\n\t\t\treturn d3.color('rgb(191, 215, 228)');\n\t\t}\n        \n\t\tlet defs = svg.append('defs');\n\n\t\tmvNode.forEach(movieNode => {\n\t\t\tdefs.append('pattern')\n\t\t\t\t.attr('id', movieNode.title.replace(/[ ']/g, '_') + '-' + movieNode.year)\n\t\t\t\t.attr('width', 1)\n\t\t\t\t.attr('height', 1)\n\t\t\t\t.attr('x', -35)\n\t\t\t\t.attr('y', -35)\n\t\t\t\t.append('image')\n\t\t\t\t.attr('xlink:href', movieNode.poster)\n\t\t\t\t.attr('width', 200)\n\t\t\t\t.attr('height', 200)\n\t\t\t\t\n        });\n        \n        let tooltip = d3.select('body')\n            .append('div')\n            .style('position', 'absolute')\n            .style('z-index', '10')\n            .style('visibility', 'hidden')\n\n\t\tlet node = svg.append('g')\n\t\t\t.attr('stroke', '#fff')\n\t\t\t.attr('stroke-width', 1.5)\n\t\t\t.selectAll('circle')\n\t\t\t.data(allNodes)\n\t\t\t.join('circle')\n\t\t\t.attr('r', radius)\n            .attr('fill', fill)\n            .on('mouseover', function(node){\n                if(node.type === 'actor') {\n                  tooltip.text(node.name);\n                  tooltip.style('visibility', 'visible');\n                  tooltip.style('top', (d3.event.y-20)+'px').style('left',(d3.event.x+20)+'px');\n                }\n            })\n\t\t\t.on('mouseout', function(){\n                return tooltip.style('visibility', 'hidden');\n            })\n\t\t\t.call(this.drag(simulation));\n\t\t\t\n\t\t\n\t\tsimulation.on('tick', () => {\n\t\t\tlink.attr('x1', d => d.source.x)\n\t\t\t\t.attr('y1', d => d.source.y)\n\t\t\t\t.attr('x2', d => d.target.x)\n\t\t\t\t.attr('y2', d => d.target.y);\n\n\t\t\tnode.attr('cx', d => d.x)\n\t\t\t\t.attr('cy', d => d.y);\n\n\t\t});\n\n\t\treturn svg.node();\n    }\n    \n    componentDidMount() {\n\t\tif (!firebase.apps.length) {\n\t\t\tfirebase.initializeApp(config);\n\t\t}\n\n\t\tlet mvNode = [];\n\t\tlet acNode = [];\n\t\tlet links = [];\n\n\t\tlet ref = firebase.database().ref('graph');\n\t\tref.on('value', snapshot => {\n\t\t\tif (!snapshot.val()) return;\n\n            let movies = snapshot.val();\n            console.log(movies);\n\n            for (let entry in movies) {\n                if(movies[entry].lists === 'GraphViz') {\n                    console.log(\"Found list\");\n                }\n                console.log(\"Not Found list\");\n            }\n\n            let moviesLength = Object.values(movies).length;\n            console.log(moviesLength);\n\t\t\tObject.values(movies).forEach(movie => {\n\t\t\t\tmovie.type = 'movie';\n\t\t\t\tconsole.log(movie);\n\t\t\t\tmvNode.push(movie);\n\n\t\t\t\tmovie.actors.forEach(actor => {\n\t\t\t\t\tlet exists = false;\n\t\t\t\t\tlet index = -1;\n\t\t\t\t\tfor (let i = 0; i < acNode.length; i++) {\n\t\t\t\t\t\tlet n =  acNode[i];\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tif (n.name === actor) {\n\t\t\t\t\t\t\texists = true;\n\t\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\tlet link = {};\n\t\t\t\t\tif (exists) {\n\t\t\t\t\t\tlink = {\n\t\t\t\t\t\t\tsource: mvNode.length - 1,\n\t\t\t\t\t\t\ttarget: moviesLength + index,\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet node = {\n\t\t\t\t\t\t\tname: actor,\n\t\t\t\t\t\t\ttype: 'actor'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tacNode.push(node);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlink = {\n\t\t\t\t\t\t\tsource: mvNode.length - 1,\n\t\t\t\t\t\t\ttarget: moviesLength + acNode.length - 1,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\n\t\t\t\t\tlinks.push(link);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tmvNode = this.state.movies.concat(mvNode);\n\t\t\tacNode = this.state.actors.concat(acNode);\n\t\t\tlinks = this.state.links.concat(links);\n\t\n\t\t\tthis.setState({\n\t\t\t\t\n\t\t\t\t'movies': mvNode,\n\t\t\t\t'actors': acNode,\n\t\t\t\t'links': links\n\t\t\t}, function(){\n                let element = document.getElementById('graph');\n\t\t        element.appendChild(this.createGraph());\n            });\n\t\t});\n\n\t}\n\t\n\trender() {\n        \n\t\treturn (\n            \n\t\t\t<div id=\"graph\">\n                <h1>Movies Graph </h1>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Graph;"]},"metadata":{},"sourceType":"module"}